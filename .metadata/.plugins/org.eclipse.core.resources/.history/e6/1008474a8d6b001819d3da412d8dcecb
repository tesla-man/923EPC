#include "msp.h"
#include "gpio.h"
#include "keypad.h"
#include "interrupt.h"
#include "timer.h"
#include "delay.h"
/**
 * main.c
 */
void main(void)
{

   P2->DIR |= BIT4;
    P2->SEL0 |= BIT4;

    P1->DIR |= BIT0;


    initClock();            //enable HFXT @ 48MHZ

    timerStruct timer;
    timer.channel = TIM0;
    timer.divide = DIV8;
    timer.mode = UPDN;
    timer.source = SMCLK;
    timer.intccr = CCR0;
    TIMER_A0->EX0 = TIMER_A_EX0_TAIDEX_6;
    TIMER_A0->CCR[0] = 8580;
    TIMER_A0->CCR[1] = 1;
    TIMER_A0->CCTL[1] |= TIMER_A_CCTLN_OUTMOD_2;
    timer_init(&timer);


    initKeypad();           //init keypad
    __enable_irq();

    uint8_t keyint = 0, keyop = 0, keycnt = 1;

    while(1){
//825, 470

        if(flag){
            if(key&0x10){
                keyint = keyint + ((key & 0x0F)*keycnt);
                keycnt = 10;
            }
            else{
                keyop = key & 0x0F;
                keycnt = 1;
            }
            flag = 0;
        }

        if(keyop == 0x03){
            TIMER_A0->CCR[1] = (keyint * 20) + 470;
            keyint = 0;
            keyop = 0;
        }
        if(keyop == 0x0A){
            TIMER_A0->CCR[1] = 470;
            keyint = 0;
            keyop = 0;
        }



    }

}
