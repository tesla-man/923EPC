/*
 * terminal.c
 *
 *  Created on: May 14, 2018
 *      Author: Contovasilis
 */

#include "term.h"
#include "delay.h"
#include "uart.h"
#include "string.h"

void termDmmSplash(void){
    float voltage = 1.254;
    uint8_t i = 255;
    printf("\033c");            //full reset
    textColor(WHITE, BLUE);
    printf("\033[2J");          //clear terminal
    printf("\033[H");           //home cursor


    //printf("\033(0");               //select special character set
    //printf("\033[2;27fDigital Multimeter Project");
    //printf("\033[3;30fCPE329 - Jeff Gerfen");
    //printf("\033%G");
   // printf("\033[1;18f");
    //printf("\033#3Digital Multimeter");
    //printf("\033[2;18f");
    //printf("\033#4Digital Multimeter");

    bigText(0, 5, "Digital Multimeter");
    textColor(GREEN, YELLOW);
    text(0, 7, "CPE329-Jeff Gerfen");
    text(0, 8, "John Contovasilis // Andes Le");

/*
    drawBarGraph(6, 6, 60);
    updateBar(6, 6, 60, 3000, 4095);
    printf("\033[7;68f  %.3fV", voltage);
    bigText(0, 2, "Digital Multimeter");
    text(0, 5, "hello");

*/


}

void drawBox(uint8_t x, uint8_t y, uint8_t height, uint8_t width){
    printf("\033(0");
    printf("\033[%d;%dfl",y,x);
    printf("\033[%d;%dfk",y,x+width);
    printf("\033[%d;%dfj",y+height,x+width);
    printf("\033[%d;%dfm",y+height,x);

    drawHLine(x+1, y, width-1);
    drawHLine(x+1, y+height, width-1);
    drawVLine(x, y+1, height-1);
    drawVLine(x+width, y+1, height-1);
    printf("\033(B");
}

void drawHLine(uint8_t x, uint8_t y, uint8_t width){
    printf("\033(0");

    while(width){
        printf("\033[%d;%dfq",y,x+width-1);
        width--;
    }
    printf("\033(B");
}

void drawVLine(uint8_t x, uint8_t y, uint8_t height){
    printf("\033(0");
    while(height){
        printf("\033[%d;%dfx",y+height-1,x);
        height--;
    }
    printf("\033(B");
}

void text(uint8_t x, uint8_t y, char *string){
    if(x==0){
        x = (TERM_COL - strlen(string))/2;
    }
    printf("\033[%d;%df%s", y, x, string);
}

void bigText(uint8_t x, uint8_t y, char *string){
    if(x==0){
        x = (TERM_COL/2 - strlen(string))/2 + 1;
    }
    printf("\033[%d;%df\033#3%s", y, x, string);
    printf("\033[%d;%df\033#4%s", y+1, x, string);
}

void textColor(uint8_t fcolor, uint8_t bcolor){
    printf("\033[1;%d;%dm", fcolor+30, bcolor+40);
}

/*
highlight(uint8_t x1, uint8_t y1, uint8_t x2, uint8_t y2, uint8_t color){
    printf("\033[%dm", attr, color+40);
}
*/
void drawBarGraph(uint8_t x, uint8_t y, uint8_t width){
    printf("\033(0");
    printf("\033[%d;%dfx",y+1,x-1);
    printf("\033[%d;%dfx",y+1,x+width);
    while(width){
        printf("\033[%d;%dfs",y,x+width-1);
        printf("\033[%d;%dfo",y+2,x+width-1);
        width--;
    }
    printf("\033(B");
}

void updateBar(uint8_t x, uint8_t y, uint8_t width, uint16_t value, uint16_t scale){
    uint16_t bars = (((value*1000)/scale)*width)/1000;
    printf("\033(0");
    printf("\033[1;43m");
    while(bars){
        printf("\033[%d;%dfa",y+1,x+bars-1);
        bars--;
    }
    printf("\033[1;44m");
    printf("\033(B");
}


