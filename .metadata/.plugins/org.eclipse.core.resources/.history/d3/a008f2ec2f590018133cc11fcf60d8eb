/*
 * terminal.c
 *
 *  Created on: May 14, 2018
 *      Author: Contovasilis
 */

#include "term.h"
#include "uart.h"

void termDmmSplash(void){
    printf("\033c");            //full reset
    printf("\033[2J");          //clear terminal
    printf("\033[H");           //home cursor
    /*
    //printf("\033[1;37;44m");     //set blue bg
    //printf("\033(0");               //select special character set
    //printf("\033[2;27fDigital Multimeter Project");
    //printf("\033[3;30fCPE329 - Jeff Gerfen");
    //printf("\033%G");
    printf("\033#3Digital Multimeter");
    printf("\033[2;0f");
    printf("\033#4Digital Multimeter");
    printf("\033[3;2f");
    drawBox(6, 6, 2, 20);
    uartWriteByte(178);
    */
    printf("\033[?38");
    uartWriteByte(29);
    tek4014_coord(       0,        0);
    tek4014_coord(4095 - 0,        0);
    tek4014_coord(4095 - 0, 3071 - 0);
    tek4014_coord(       0, 3071 - 0);
    tek4014_coord(       0,        0);




}

void drawBox(uint8_t x, uint8_t y, uint8_t height, uint8_t width){
    printf("\033(0");
    printf("\033[%d;%dfl",y,x);
    printf("\033[%d;%dfk",y,x+width);
    printf("\033[%d;%dfj",y+height,x+width);
    printf("\033[%d;%dfm",y+height,x);

    drawHLine(x+1, y, width-1);
    drawHLine(x+1, y+height, width-1);
    drawVLine(x, y+1, height-1);
    drawVLine(x+width, y+1, height-1);
    printf("\033%%G");
}

void drawHLine(uint8_t x, uint8_t y, uint8_t width){
    //printf("\033(0");

    while(width){
        printf("\033[%d;%dfq",y,x+width-1);
        width--;
    }
    //printf("\033%%G");
}

void drawVLine(uint8_t x, uint8_t y, uint8_t height){
    //printf("\033(0");
    while(height){
        printf("\033[%d;%dfx",y+height-1,x);
        height--;
    }
    //printf("\033%%G");
}
void termDmmDC(void){

}

void termDmmAC(void){

}

void termDmmBargraph(void){

}

tek4014_coord(unsigned x, unsigned y)
{
    unsigned char lox, loy, hix, hiy, eb;
    static unsigned char lloy = -1, lhix = -1, lhiy = -1, leb = -1;

    if (y > 3071)
        y = 3071;
    if (x > 4095)
        x = 4095;
    hiy = (y >> 7) & 0x1f;
    loy = (y >> 2) & 0x1f;
    hix = (x >> 7) & 0x1f;
    lox = (x >> 2) & 0x1f;
    eb = (x & 3) | ((y & 3) << 2);

    if (hiy != lhiy)
        uartWriteByte(hiy | 0x20);
    if (eb != leb)
        uartWriteByte( eb | 0x60);
    if (eb != leb || loy != lloy || hix != lhix)
        uartWriteByte(loy | 0x60);
    if (hix != lhix)
        uartWriteByte(hix | 0x20);
    uartWriteByte(lox | 0x40);
        lhiy = hiy;
        lhix = hix;
        lloy = loy;
        leb = eb;
}




